generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Household {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  members   HouseholdMember[]
  recipes   Recipe[]
  mealPlans MealPlan[]
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  avatarUrl    String?
  createdAt    DateTime @default(now())
  
  households   HouseholdMember[]
}

model HouseholdMember {
  id          String    @id @default(cuid())
  userId      String
  householdId String
  role        Role      @default(MEMBER)
  joinedAt    DateTime  @default(now())
  
  user        User      @relation(fields: [userId], references: [id])
  household   Household @relation(fields: [householdId], references: [id])
  
  @@unique([userId, householdId])
}

model Recipe {
  id           String   @id @default(cuid())
  householdId  String
  title        String
  description  String?
  imageUrl     String?
  sourceUrl    String?
  servings     Int?
  prepTime     Int?     // minutes
  cookTime     Int?     // minutes
  ingredients  Json     // Structured ingredient list
  instructions Json     // Step-by-step instructions
  notes        Json?    // Notes or tips
  prepGroups   Json     // "Mise" section - prep groupings
  tags         String[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  household    Household  @relation(fields: [householdId], references: [id])
  mealPlans    MealPlan[]
}

model MealPlan {
  id          String   @id @default(cuid())
  householdId String
  recipeId    String
  date        DateTime @db.Date
  mealType    MealType @default(DINNER)
  servings    Int      @default(2)
  
  household   Household @relation(fields: [householdId], references: [id])
  recipe      Recipe    @relation(fields: [recipeId], references: [id])
  
  @@unique([householdId, date, mealType])
}

enum Role {
  OWNER
  ADMIN
  MEMBER
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK
}
